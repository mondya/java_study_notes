# JavaWeb

## 1.åŸºæœ¬æ¦‚å¿µ

webå¼€å‘ï¼š

- webï¼šç½‘é¡µ
- é™æ€web
  - html,css
  - æä¾›æ‰€æœ‰äººçœ‹çš„æ•°æ®ï¼Œå§‹ç»ˆä¸ä¼šå‘ç”Ÿå˜åŒ–
- åŠ¨æ€web
  - æ•°æ®å‘ç”Ÿå˜åŒ–ï¼Œæ¯ä¸ªäººåœ¨ä¸åŒæ—¶é—´ï¼Œä¸åŒåœ°ç‚¹çœ‹åˆ°çš„ä¿¡æ¯å„ä¸ç›¸åŒ
  - å‡ ä¹æ‰€æœ‰ç½‘ç«™
  - æŠ€æœ¯æ ˆï¼šServlet/JSP, ASP, PHP 

åœ¨Javaä¸­ï¼ŒåŠ¨æ€webèµ„æºå¼€å‘çš„æŠ€æœ¯ç»Ÿç§°ä¸ºJavaWeb

### 1.1 webåº”ç”¨ç¨‹åº

webåº”ç”¨ç¨‹åºï¼šå¯ä»¥æä¾›æµè§ˆå™¨è®¿é—®çš„ç¨‹åº

- a.html , b.html ...... å¤šä¸ªwebèµ„æºï¼Œè¿™äº›webèµ„æºå¯ä»¥è¢«å¤–ç•Œè®¿é—®ï¼Œå¯¹å¤–ç•Œæä¾›æœåŠ¡
- è¿™ä¸ªç»Ÿä¸€çš„webèµ„æºä¼šè¢«æ”¾åœ¨åŒä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹ï¼Œwebåº”ç”¨ç¨‹åº-->Tomcat:æœåŠ¡å™¨
- ä¸€ä¸ªwebåº”ç”¨ç”±å¤šä¸ªéƒ¨åˆ†ç»„æˆï¼ˆé™æ€web,åŠ¨æ€webï¼‰
	 	html,css,js
	 	jsp,servlet
	 	javaç¨‹åº
	 	jaråŒ…
	 	é…ç½®æ–‡ä»¶(Properties)

webåº”ç”¨ç¨‹åºç¼–å†™å®Œæ¯•åï¼Œè‹¥æƒ³æä¾›ç»™å¤–ç•Œè®¿é—®ï¼Œéœ€è¦ä¸€ä¸ªæœåŠ¡å™¨æ¥ç»Ÿä¸€ç®¡ç†
###1.2 é™æ€web

- *.html , *.htm ,è¿™äº›éƒ½æ˜¯ç½‘é¡µçš„åç¼€ï¼Œå¦‚æœæœåŠ¡å™¨ä¸Šä¸€ç›´å­˜åœ¨è¿™äº›ä¸œè¥¿ï¼Œå¯ä»¥ç›´æ¥è¿›è¡Œè®¿é—®ã€‚

![image-20201226220504964](./images/image-20201226220504964.png)

- é™æ€webå­˜åœ¨çš„ç¼ºç‚¹
  - webé¡µé¢æ— æ³•åŠ¨æ€æ›´æ–°ï¼Œæ‰€æœ‰ç”¨æˆ·çœ‹åˆ°åŒä¸€ä¸ªé¡µé¢
    - è½®æ’­å›¾ï¼Œç‚¹å‡»ç‰¹æ•ˆï¼šä¼ªåŠ¨æ€
    - JavaScript(ä½¿ç”¨æœ€å¤š)
    - VBScript
  - å®ƒæ— æ³•å’Œæ•°æ®åº“äº¤äº’ï¼ˆæ•°æ®æ— æ³•æŒä¹…åŒ–ï¼Œç”¨æˆ·æ— æ³•äº¤äº’ï¼‰

### 1.3åŠ¨æ€web

é¡µé¢ä¼šåŠ¨æ€å±•ç¤ºï¼šâ€œwebçš„é¡µé¢å±•ç¤ºçš„æ•ˆæœï¼Œæ¯ä¸ªäººéƒ½ä¸åŒâ€

![image-20201226222346494](./images/image-20201226222346494.png)

ç¼ºç‚¹

- åŠ å…¥æœåŠ¡å™¨çš„åŠ¨æ€webèµ„æºå‡ºç°äº†é”™è¯¯ï¼Œéœ€è¦é‡æ–°ç¼–å†™**åå°ç¨‹åº**
- åœæœºç»´æŠ¤

ä¼˜ç‚¹

- webé¡µé¢åŠ¨æ€æ›´æ–°
- å¯ä»¥å’Œæ•°æ®åº“äº¤äº’ï¼ˆæ•°æ®æŒä¹…åŒ–ï¼šæ³¨å†Œï¼Œç”¨æˆ·ä¿¡æ¯ï¼‰

## 2.webæœåŠ¡å™¨

### 2.1webæœåŠ¡å™¨

æœåŠ¡å™¨æ˜¯ä¸€ç§è¢«åŠ¨çš„æ“ä½œï¼Œç”¨æ¥å¤„ç†ç”¨æˆ·çš„ä¸€äº›è¯·æ±‚å’Œç»™ç”¨æˆ·ä¸€äº›å“åº”ä¿¡æ¯

**IIS**

å¾®è½¯æä¾›ï¼›ASP...,Windowsè‡ªå¸¦

**Tomcat**

å…è´¹                                                                                                                                   

> æ–‡ä»¶å¤¹ä¿¡æ¯

![image-20201227200624227](./images/image-20201227200624227.png)

### 2.2é…ç½®

å¯ä»¥é…ç½®å¯åŠ¨çš„ç«¯å£å·

- é»˜è®¤ç«¯å£å·ä¸º8080
- mysql:3306
- http:80
- https:443

```xml
    <Connector port="8080" protocol="HTTP/1.1"
               connectionTimeout="20000"
               redirectPort="8443" />
```

å¯ä»¥é…ç½®ä¸»æœºçš„åç§°

- é»˜è®¤çš„ä¸»æœºåä¸ºï¼šlocalhost->127.0.0.1

```xml
      <Host name="www.xhh.com"  appBase="webapps"
            unpackWARs="true" autoDeploy="true">
```

- ä¿®æ”¹C:\Windows\System32\drivers\etcä¸‹çš„hostsæ–‡ä»¶

```xml
127.0.0.1	www.xhh.com
```

### 2.3å‘å¸ƒç½‘ç«™

ç½‘ç«™åº”è¯¥æœ‰çš„ç»“æ„

```java
--webapps : TomcatæœåŠ¡å™¨çš„webç›®å½•
    -ROOT
    -study: ç½‘ç«™çš„ç›®å½•å
        -WEB-INF
        	-classes :java ç¨‹åº
                -lib : webåº”ç”¨æ‰€ä¾èµ–çš„jaråŒ…
                 -web.xml ï¼š ç½‘ç«™é…ç½®æ–‡ä»¶
        -index.html é»˜è®¤çš„é¦–é¡µ
        -static
                  -css
                    -style.css
                   -js
                   -img
```

## 3.HTTP

### 3.1ä»€ä¹ˆæ˜¯http

HTTP(è¶…æ–‡æœ¬ä¼ è¾“åè®® )æ˜¯ä¸€ä¸ªç®€å•çš„è¯·æ±‚-å“åº”åè®®ï¼Œå®ƒé€šå¸¸è¿è¡Œåœ¨TCPä¹‹ä¸Š

### 3.2HTTPè¯·æ±‚

- å®¢æˆ·ç«¯-è¯·æ±‚-æœåŠ¡å™¨

- > ä½¿ç”¨baiduä¸ºä¾‹

```java
Request URL: https://www.baidu.com/   è¯·æ±‚åœ°å€
Request Method: GET					è¯·æ±‚æ–¹æ³•get/post
Status Code: 200 OK					çŠ¶æ€ç ï¼š200
Remote Address: 36.152.44.95:443		
Referrer Policy: strict-origin-when-cross-origin
```

### 3.3HTTPå“åº”

- æœåŠ¡å™¨-å“åº”-å®¢æˆ·ç«¯

```java
Cache-Control: private		ç¼“å­˜æ§åˆ¶
Connection: keep-alive		è¿æ¥
Content-Encoding: gzip		ç¼–ç 
Content-Type: text/html;charset=utf-8 ç±»å‹
```

#### å“åº”çŠ¶æ€ç 

200ï¼šè¯·æ±‚æˆåŠŸ

3**ï¼šè¯·æ±‚é‡å®šå‘

- é‡å®šå‘ï¼šé‡æ–°è·³è½¬åˆ°æŒ‡å®šçš„æ–°ä½ç½®

4**ï¼šæ‰¾ä¸åˆ°èµ„æº 404

- èµ„æºä¸å­˜åœ¨

5**ï¼šæœåŠ¡å™¨ä»£ç é”™è¯¯ 500ï¼šç½‘å…³é”™è¯¯

## 4.MAVEN

ç¯å¢ƒå˜é‡(MAVEN_HOME,M2_HOME)ï¼Œé˜¿é‡Œäº‘é•œåƒï¼Œæœ¬åœ°ä»“åº“

### 4.1åœ¨IDEAä¸­ä½¿ç”¨maven

![image-20201228220937811](./images/image-20201228220937811.png)

### 4.2é…ç½®tomcat

![image-20201228221930514](./images/image-20201228221930514.png)

## 5.Servlet

### 5.1Servletç®€ä»‹

- Servletæ˜¯sunå…¬å¸å¼€å‘åŠ¨æ€webçš„ä¸€é—¨æŠ€æœ¯
- sunåœ¨è¿™äº›APIä¸­æä¾›ä¸€ä¸ªæ¥å£å«åšï¼šServletï¼Œå¦‚æœæƒ³è¦å¼€å‘ä¸€ä¸ªServletç¨‹åºï¼Œåªéœ€è¦å®Œæˆä¸¤ä¸ªå°æ­¥éª¤ï¼š
  - ç¼–å†™ä¸€ä¸ªç±»ï¼Œå®ç°Servletæ¥å£
  - æŠŠå¼€å‘å¥½çš„javaç±»éƒ¨ç½²åˆ°webæœåŠ¡å™¨ä¸­

**æŠŠå®ç°äº†Servletæ¥å£çš„javaç¨‹åºå«åšServlet**

### 5.2HelloServlet

Servletæ¥å£sunæœ‰ä¸¤ä¸ªé»˜è®¤çš„å®ç°ç±»ï¼šHttpServlet

1.æ„å»ºä¸€ä¸ªmavené¡¹ç›®ï¼Œåˆ é™¤srcç›®å½•ï¼Œåˆ›å»ºMoudel;æ­¤ç©ºå·¥ç¨‹å°±æ˜¯é¡¹ç›®çš„çˆ¶å·¥ç¨‹

2.æ–°å»ºMoudleï¼Œåˆ›å»ºwebæ¶æ„

3.ç¼–å†™ä¸€ä¸ªServletç¨‹åº

â€‹	1.ç¼–å†™ä¸€ä¸ªæ™®éç±»

â€‹	2.å®ç°Servletæ¥å£ï¼Œç»§æ‰¿HttpServlet

å®ç°åŸç†

![image-20201229225332811](./images/image-20201229225332811.png)

```java
public class HelloServlet extends HttpServlet {
    //ç”±äºget/poståªæ˜¯è¯·æ±‚å®ç°çš„æ–¹å¼ä¸åŒï¼Œå¯ä»¥äº’ç›¸è°ƒç”¨ï¼Œä¸šåŠ¡é€»è¾‘éƒ½ç›¸åŒ
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        PrintWriter writer = resp.getWriter();  //å“åº”æµ
        writer.print("HelloServlet");
    }

    @Override
    protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        doGet(req, resp);
    }
}
```

4.ç¼–å†™Servletçš„æ˜ å°„

ä¸ºä»€ä¹ˆéœ€è¦æ˜ å°„ï¼šæˆ‘ä»¬å†™çš„æ˜¯JAVAç¨‹åºï¼Œä½†æ˜¯è¦é€šè¿‡æµè§ˆå™¨è®¿é—®ï¼Œè€Œæµè§ˆå™¨éœ€è¦è¿æ¥webæœåŠ¡å™¨ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨webæœåŠ¡å™¨ä¸­æ³¨å†Œæ‰€å†™çš„Serveltï¼Œè¿˜éœ€è¦ç»™æµè§ˆå™¨è®¿é—®çš„åœ°å€

```xml
<!--æ³¨å†ŒServlet-->
    <servlet>
        <servlet-name>hello</servlet-name>
        <servlet-class>com.xhh.servlet.HelloServlet</servlet-class>
    </servlet>
    <!--Servletçš„è¯·æ±‚è·¯å¾„-->
    <servlet-mapping>
        <servlet-name>hello</servlet-name>
        <url-pattern>/hello</url-pattern>
    </servlet-mapping>
```

### 5.3ServletåŸç†

Servletæ˜¯ç”±WebæœåŠ¡å™¨ï¼ŒwebæœåŠ¡å™¨åœ¨æ”¶åˆ°è¯·æ±‚åä¼šè¿›è¡Œå¤„ç†

> Servletçš„ç‰¹ç‚¹

- Serveltå¯¹è±¡ï¼Œç”±Serveltå®¹å™¨ï¼ˆTomcatï¼‰åˆ›å»º
- Serveltæ˜¯ä¸€ä¸ªæ¥å£ï¼šä½äº`javax.servlet`åŒ…ä¸­
- serviceæ–¹æ³•ç”¨äºæ¥æ”¶ç”¨æˆ·çš„è¯·æ±‚å¹¶è¿”å›å“åº”
- ç”¨æˆ·è®¿é—®æ—¶å¤šæ¬¡è¢«æ‰§è¡Œï¼ˆå¯ä»¥ç»Ÿè®¡ç½‘ç«™çš„è®¿é—®é‡ï¼‰

> Servletç”Ÿå‘½å‘¨æœŸçš„æ–¹æ³•ï¼šä»¥ä¸‹æ–¹æ³•éƒ½æ˜¯ç”±Servletå®¹å™¨è´Ÿè´£è°ƒç”¨

> https://www.cnblogs.com/java-chen-hao/p/10688617.html

- æ„é€ å™¨ï¼šåªè¢«è°ƒç”¨ä¸€æ¬¡ã€‚åª	æœ‰ç¬¬ä¸€æ¬¡è°ƒç”¨Servletæ—¶ï¼Œåˆ›å»ºServletçš„å®ä¾‹ï¼Œè°ƒç”¨æ„é€ å™¨ã€‚==è¿™è¯´æ˜Servletæ˜¯å•å®ä¾‹çš„==
- initæ–¹æ³•ï¼šåªè¢«è°ƒç”¨ä¸€æ¬¡ï¼Œåœ¨åˆ›å»ºå¥½Servletåç«‹å³è°ƒç”¨ï¼Œç”¨äºåˆå§‹åŒ–å½“å‰Servlet
- serviceï¼šè¢«å¤šæ¬¡è°ƒç”¨ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½ä¼šè°ƒç”¨serviceæ–¹æ³•ï¼Œå®é™…ç”¨äºå“åº”è¯·æ±‚
- destory:åªè¢«è°ƒç”¨ä¸€æ¬¡ï¼Œåœ¨å½“å‰Servletæ‰€åœ¨çš„WEBåº”ç”¨è¢«å¸è½½å‰è°ƒç”¨ã€‚ç”¨äºé‡Šæ”¾å½“å‰Servletæ‰€å çš„èµ„æº

### 5.4Mappingé—®é¢˜

> ä¸€ä¸ªServletå¯ä»¥æŒ‡å®šå¤šä¸ªæ˜ å°„è·¯å¾„

```xml
    <servlet-mapping>
        <servlet-name>hello</servlet-name>
        <url-pattern>/hello</url-pattern>
    </servlet-mapping>
    <servlet-mapping>
        <servlet-name>hello</servlet-name>
        <url-pattern>/hello2</url-pattern>
    </servlet-mapping>
    <servlet-mapping>
        <servlet-name>hello</servlet-name>
        <url-pattern>/hello3</url-pattern>
    </servlet-mapping>
```

> ä¸€ä¸ªServletå¯ä»¥æŒ‡å®šé€šç”¨æ˜ å°„è·¯å¾„

```xml
    <servlet-mapping>
        <servlet-name>hello</servlet-name>
        <url-pattern>/hello/*</url-pattern>
    </servlet-mapping>
```

```xml
    <!--é»˜è®¤è¯·æ±‚è·¯å¾„-->
    <servlet-mapping>
        <servlet-name>hello</servlet-name>
        <url-pattern>/*</url-pattern>
    </servlet-mapping>
```

> æŒ‡å®šä¸€äº›åç¼€æˆ–è€…å‰ç¼€

```xml
    <!--å¯ä»¥è‡ªå®šä¹‰åç¼€å®ç°è¯·æ±‚æ˜ å°„
    æ³¨æ„ç‚¹ï¼š*å‰é¢ä¸èƒ½åŠ æ˜ å°„çš„è·¯å¾„
    -->
    <servlet-mapping>
        <servlet-name>hello</servlet-name>
        <url-pattern>*.xhh</url-pattern>
    </servlet-mapping>
```

> ä¼˜å…ˆçº§é—®é¢˜

æŒ‡å®šäº†å›ºæœ‰çš„æ˜ å°„è·¯å¾„ä¼˜å…ˆçº§æœ€é«˜ï¼Œå¦‚æœæ‰¾ä¸åˆ°å°±ä¼šèµ°é»˜è®¤çš„å¤„ç†è¯·æ±‚

### 5.5ServletContext

webå®¹å™¨åœ¨å¯åŠ¨æ—¶ï¼Œä¼šä¸ºæ¯ä¸€ä¸ªwebç¨‹åºéƒ½åˆ›å»ºä¸€ä¸ªå¯¹åº”çš„ServletContextå¯¹è±¡ï¼Œä»£è¡¨äº†å½“å‰çš„webåº”ç”¨

#### 1.å…±äº«æ•°æ®

åœ¨Servletä¸­ä¿å­˜çš„æ•°æ®ï¼Œå¯ä»¥åœ¨å¦å¤–ä¸€ä¸ªServletä¸­æ‹¿åˆ°ï¼š

```java
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        ServletContext servletContext = this.getServletContext();
        String name = "å¼ ä¸‰";
        servletContext.setAttribute("username",name);
    }
```

```java
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        ServletContext servletContext = this.getServletContext();
        String username = (String)servletContext.getAttribute("username");

        resp.setContentType("text/html");
        resp.setCharacterEncoding("utf-8");
        resp.getWriter().print("åå­—"+username);
    }
```

æµ‹è¯•è®¿é—®ç»“æœ

#### 2.è·å–åˆå§‹åŒ–å‚æ•°

#### 3.è¯·æ±‚è½¬å‘

#### 4.è¯»å–èµ„æºæ–‡ä»¶

### 5.6HttpServletResponse

webæœåŠ¡å™¨æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„httpè¯·æ±‚ï¼Œé’ˆå¯¹è¿™ä¸ªè¯·æ±‚ï¼Œåˆ†åˆ«åˆ›å»ºä¸€ä¸ªä»£è¡¨è¯·æ±‚çš„HttpServeltRequestå¯¹è±¡ï¼Œä»£è¡¨å“åº”çš„ä¸€ä¸ªHttpServletResponse;

- å¦‚æœè¦è·å–å®¢æˆ·ç«¯è¯·æ±‚çš„å‚æ•°ï¼šå¯»æ‰¾HttpServeltRequest
- å¦‚æœè¦ç»™å®¢æˆ·ç«¯å“åº”ä¸€äº›ä¿¡æ¯ï¼šæ‰¾HttpServletResponse

#### ç®€å•åˆ†ç±»

> è´Ÿè´£å‘æµè§ˆå™¨å‘é€æ•°æ®çš„æ–¹æ³•

```java
    ServletOutputStream getOutputStream() throws IOException;
    PrintWriter getWriter() throws IOException;
```

> è´Ÿè´£å‘æµè§ˆå™¨å‘é€å“åº”å¤´çš„æ–¹æ³•

```java
    void setContentLength(int var1);
    void setContentLengthLong(long var1);
    void setContentType(String var1);
    void setBufferSize(int var1);
    void sendError(int var1, String var2) throws IOException;

    void sendError(int var1) throws IOException;

    void sendRedirect(String var1) throws IOException;

    void setDateHeader(String var1, long var2);

    void addDateHeader(String var1, long var2);

    void setHeader(String var1, String var2);

    void addHeader(String var1, String var2);

    void setIntHeader(String var1, int var2);

    void addIntHeader(String var1, int var2);
```

> çŠ¶æ€ç 

```java
    int SC_CONTINUE = 100;
    int SC_SWITCHING_PROTOCOLS = 101;
    int SC_OK = 200;
    int SC_CREATED = 201;
    int SC_ACCEPTED = 202;
    int SC_NON_AUTHORITATIVE_INFORMATION = 203;
    int SC_NO_CONTENT = 204;
    int SC_RESET_CONTENT = 205;
    int SC_PARTIAL_CONTENT = 206;
    int SC_MULTIPLE_CHOICES = 300;
    int SC_MOVED_PERMANENTLY = 301;
    int SC_MOVED_TEMPORARILY = 302;
    int SC_FOUND = 302;
    int SC_SEE_OTHER = 303;
    int SC_NOT_MODIFIED = 304;
    int SC_USE_PROXY = 305;
    int SC_TEMPORARY_REDIRECT = 307;
    int SC_BAD_REQUEST = 400;
    int SC_UNAUTHORIZED = 401;
    int SC_PAYMENT_REQUIRED = 402;
    int SC_FORBIDDEN = 403;
    int SC_NOT_FOUND = 404;
    int SC_METHOD_NOT_ALLOWED = 405;
    int SC_NOT_ACCEPTABLE = 406;
    int SC_PROXY_AUTHENTICATION_REQUIRED = 407;
    int SC_REQUEST_TIMEOUT = 408;
    int SC_CONFLICT = 409;
    int SC_GONE = 410;
    int SC_LENGTH_REQUIRED = 411;
    int SC_PRECONDITION_FAILED = 412;
    int SC_REQUEST_ENTITY_TOO_LARGE = 413;
    int SC_REQUEST_URI_TOO_LONG = 414;
    int SC_UNSUPPORTED_MEDIA_TYPE = 415;
    int SC_REQUESTED_RANGE_NOT_SATISFIABLE = 416;
    int SC_EXPECTATION_FAILED = 417;
    int SC_INTERNAL_SERVER_ERROR = 500;
    int SC_NOT_IMPLEMENTED = 501;
    int SC_BAD_GATEWAY = 502;
    int SC_SERVICE_UNAVAILABLE = 503;
    int SC_GATEWAY_TIMEOUT = 504;
    int SC_HTTP_VERSION_NOT_SUPPORTED = 505;
```

#### å¸¸è§åº”ç”¨

##### 1.å‘æµè§ˆå™¨è¾“å‡ºæ¶ˆæ¯

##### 2.ä¸‹è½½æ–‡ä»¶

- è·å–ä¸‹è½½æ–‡ä»¶çš„è·¯å¾„
- ä¸‹è½½çš„æ–‡ä»¶å
- è®¾ç½®è®©æµè§ˆå™¨èƒ½å¤Ÿæ”¯æŒä¸‹è½½éœ€è¦çš„æ–‡ä»¶
- è·å–ä¸‹è½½æ–‡ä»¶çš„è¾“å…¥æµ
- åˆ›å»ºç¼“å†²åŒº
- è·å–OutputStreamå¯¹è±¡
- å°†FileOutputStreamæµå†™å…¥åˆ°bufferç¼“å†²åŒº
- ä½¿ç”¨OutputStreamå°†ç¼“å†²åŒºä¸­çš„æ•°æ®è¾“å‡ºåˆ°å®¢æˆ·ç«¯ä¸­

```java
public class FileServlet extends HttpServlet {

    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        //  - è·å–ä¸‹è½½æ–‡ä»¶çš„è·¯å¾„
        //String realPath = this.getServletContext().getRealPath("/gta5.jpg");
        String realPath = "D:\\idea_Workspace\\javawebStudy\\javaweb-02-servlet\\response\\target\\classes\\gta5.jpg";
//- ä¸‹è½½çš„æ–‡ä»¶å
        String fileName = realPath.substring(realPath.lastIndexOf("\\")+1);
//- è®¾ç½®è®©æµè§ˆå™¨èƒ½å¤Ÿæ”¯æŒä¸‹è½½éœ€è¦çš„æ–‡ä»¶
        resp.setHeader("Content-disposition","attachment;fileName"+fileName);
//- è·å–ä¸‹è½½æ–‡ä»¶çš„è¾“å…¥æµ
        FileInputStream fileInputStream = new FileInputStream(realPath);
//- åˆ›å»ºç¼“å†²åŒº
        int len = 0;
        byte[] buffer = new byte[1024];
//- è·å–OutputStreamå¯¹è±¡
        ServletOutputStream outputStream = resp.getOutputStream();
//- å°†FileOutputStreamæµå†™å…¥åˆ°bufferç¼“å†²åŒº,ä½¿ç”¨OutputStreamå°†ç¼“å†²åŒºä¸­çš„æ•°æ®è¾“å‡ºåˆ°å®¢æˆ·ç«¯ä¸­
        while((len=fileInputStream.read(buffer))>0){
            outputStream.write(buffer,0,len);
        }
        //å…³é—­æµ
        fileInputStream.close();
        outputStream.close();
    }
```

##### 3.éªŒè¯ç åŠŸèƒ½

- åç«¯å®ç°ï¼Œéœ€è¦ç”¨åˆ°Javaçš„å›¾ç‰‡ç±»ï¼Œç”Ÿäº§ä¸€ä¸ªå›¾ç‰‡

```java
public class ImageServlet extends HttpServlet {
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        //å¦‚ä½•è®©æµè§ˆå™¨5ç§’è‡ªåŠ¨åˆ·æ–°ä¸€æ¬¡
        resp.setHeader("refresh","3");

        //åœ¨å†…å­˜ä¸­åˆ›å»ºä¸€ä¸ªå›¾ç‰‡
        BufferedImage bufferedImage = new BufferedImage(80,20,BufferedImage.TYPE_INT_RGB);

        //å¾—åˆ°å›¾ç‰‡
        Graphics2D graphics = (Graphics2D) bufferedImage.getGraphics();//ğŸ–Š
        //è®¾ç½®å›¾ç‰‡çš„èƒŒæ™¯é¢œè‰²
        graphics.setColor(Color.white);
        graphics.fillRect(0,0,80,20);
        //ç»™å›¾ç‰‡å†™æ•°æ®
        graphics.setColor(Color.blue);
        graphics.setFont(new Font(null,Font.BOLD,20));
        graphics.drawString(makeNum(),0,20);

        //å‘Šè¯‰æµè§ˆå™¨ï¼Œè¿™ä¸ªè¯·æ±‚ç”¨å›¾ç‰‡çš„æ–¹å¼æ‰“å¼€
        resp.setContentType("image/jpeg");
        //ç½‘ç«™å­˜åœ¨ç¼“å­˜ï¼Œç¦æ­¢æµè§ˆå™¨ç¼“å­˜
        resp.setDateHeader("expires",-1);
        resp.setHeader("Cache-Control","no-cache");
        resp.setHeader("Pragma","no-cache");

        //æŠŠå›¾ç‰‡å†™ç»™æµè§ˆå™¨
        ImageIO.write(bufferedImage,"jpg",resp.getOutputStream());
    }

    //ç”Ÿæˆéšæœºæ•°
    private String makeNum(){
        Random random = new Random();
        String num = random.nextInt(9999999)+"";
        StringBuffer sb = new StringBuffer();
        for (int i = 0; i < 7-num.length() ; i++) {
            sb.append("0");
        }
        num = sb.toString() + num;
        return num;
    }
```

##### ==4.å®ç°é‡å®šå‘==

ä¸€ä¸ªwebèµ„æºæ”¶åˆ°å®¢æˆ·ç«¯è¯·æ±‚åï¼Œä¼šé€šçŸ¥å®¢æˆ·ç«¯å»è®¿é—®å¦å¤–ä¸€ä¸ªwebèµ„æºï¼Œè¿™ä¸ªè¿‡ç¨‹å«åšé‡å®šå‘

å¸¸è§åœºæ™¯ï¼šç”¨æˆ·ç™»å…¥

`void sendRedirect(String var1) throws IOException;`

> é‡å®šå‘å’Œè½¬å‘

ç›¸åŒç‚¹ï¼š

- é¡µé¢éƒ½ä¼šå®ç°è·³è½¬

ä¸åŒç‚¹ï¼š

- è¯·æ±‚è½¬å‘çš„æ—¶å€™ï¼Œurlä¸ä¼šäº§ç”Ÿå˜åŒ– 307
- é‡å®šå‘æ—¶ï¼Œurlä¼šå‘ç”Ÿå˜åŒ– 302

```java
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        //å¤„ç†è¯·æ±‚
        String username = req.getParameter("username");
        String password = req.getParameter("password");

        System.out.println(username+":"+password);
        //é‡å®šå‘æ—¶éœ€è¦æ³¨æ„è·¯å¾„é—®é¢˜
        resp.sendRedirect("/success.jsp");
    }
```

### 5.7HttpServletRequest

HttpServletRequestä»£è¡¨å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œç”¨æˆ·é€šè¿‡Httpåè®®è®¿é—®æœåŠ¡å™¨ï¼ŒHTTPè¯·æ±‚ä¸­çš„æ‰€æœ‰ä¿¡æ¯éƒ½ä¼šè¢«å°è£…åˆ°HttpServletRequest,é€šè¿‡HttpServletRequestçš„æ–¹æ³•ï¼Œè·å–å®¢æˆ·ç«¯çš„æ‰€æœ‰ä¿¡æ¯

#### 1.è·å–å‰ç«¯å‚æ•°HttpServletRequest

`getParameter(String s)`å’Œ`getParameterValues(String s)`

#### 2.è¯·æ±‚è½¬å‘

```java
public class LoginServlet extends HttpServlet {
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        req.setCharacterEncoding("utf-8");
        resp.setCharacterEncoding("utf-8");
        String username = req.getParameter("username");
        String password = req.getParameter("password");
        String[] hobbys = req.getParameterValues("hobbys");

        //æ§åˆ¶å°è¾“å‡º
        System.out.println(username);
        System.out.println(password);
        System.out.println(Arrays.toString(hobbys));

        //è¯·æ±‚è½¬å‘
        req.getRequestDispatcher(req.getContextPath()+"/success.jsp").forward(req,resp);
    }
```

## 6.Cookie,Session

### 6.1ä¼šè¯

**ä¼šè¯**ç”¨æˆ·æ‰“å¼€ä¸€ä¸ªæµè§ˆå™¨ï¼Œç‚¹å‡»äº†å¾ˆå¤šè¶…é“¾æ¥ï¼Œè®¿é—®å¤šä¸ªwebèµ„æºï¼Œå…³é—­æµè§ˆå™¨ï¼Œè¿™ä¸ªè¿‡ç¨‹å«åšä¼šè¯

**ä¸€ä¸ªç½‘ç«™ï¼Œæ€ä¹ˆè¯æ˜ä½ æ¥è¿‡ï¼Ÿ**

å®¢æˆ·ç«¯		æœåŠ¡ç«¯

1.æœåŠ¡ç«¯ç»™å®¢æˆ·ç«¯ä¸€ä¸ªä¿¡ä»¶ï¼Œå®¢æˆ·ç«¯ä¸‹æ¬¡è®¿é—®æœåŠ¡å™¨ç«¯å¸¦ä¸Šä¿¡ä»¶å°±å¯ä»¥äº†ï¼›cookie

2.æœåŠ¡å™¨ç™»è®°ä½ æ¥è¿‡äº†ï¼Œä¸‹æ¬¡æ¥çš„æ—¶å€™åŒ¹é…ï¼›session

### 6.2ä¿å­˜ä¼šè¯çš„ä¸¤ç§æŠ€æœ¯

##### cookie                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           

- å®¢æˆ·ç«¯æŠ€æœ¯ï¼ˆå“åº”ï¼Œè¯·æ±‚ï¼‰

##### session

- æœåŠ¡å™¨æŠ€æœ¯ï¼Œåˆ©ç”¨è¿™ä¸ªæŠ€æœ¯ï¼Œå¯ä»¥ä¿å­˜ç”¨æˆ·çš„ä¼šè¯ä¿¡æ¯ï¼›å¯ä»¥æŠŠä¿¡æ¯æˆ–è€…æ•°æ®æ”¾åœ¨sessionä¸­

### 6.3Cookie

1.ä»è¯·æ±‚ä¸­æ‹¿åˆ°cookieä¿¡æ¯

2.æœåŠ¡å™¨å“åº”ç»™å®¢æˆ·ç«¯cookie

```java
Cookie[] cookies = req.getCookies(); //è·å¾—cookie
cookie.getName();//è·å¾—Cookieçš„key
cookie.getValue();//è·å¾—cookieä¸­çš„value
;//æ–°å»ºä¸€ä¸ªcookie
cookie.setMaxAge(24*60*60);//è®¾ç½®cookieçš„ä¿å­˜æ—¶é—´
resp.addCookie(cookie);//ç»™å®¢æˆ·ç«¯å“åº”ä¸€ä¸ªcookie
```

ä¸€ä¸ªç½‘ç«™çš„cookieå­˜åœ¨ä¸Šé™

- ä¸€ä¸ªcookieåªèƒ½ä¿å­˜ä¸€ä¸ªä¿¡æ¯
- ä¸€ä¸ªwebç«™ç‚¹å¯ä»¥ç»™æµè§ˆå™¨å‘é€å¤šä¸ªcookieï¼Œæœ€å¤šå­˜æ”¾20ä¸ªcookie
- cookieå¤§å°æœ‰é™åˆ¶
- 300ä¸ªcookieä¸ºæµè§ˆå™¨ä¸Šé™

åˆ é™¤cookie

- ä¸è®¾ç½®æœ‰æ•ˆæœŸï¼Œå…³é—­æµè§ˆå™¨è‡ªåŠ¨å¤±æ•ˆ
- è®¾ç½®æœ‰æ•ˆæœŸæ—¶é—´ä¸º0

### 6.4Sessionï¼ˆé‡ç‚¹ï¼‰

ä»€ä¹ˆæ˜¯Session:

- æœåŠ¡å™¨ä¼šç»™æ¯ä¸€ä¸ªç”¨æˆ·ï¼ˆæµè§ˆå™¨ï¼‰åˆ›å»ºä¸€ä¸ªSessionå¯¹è±¡
- ä¸€ä¸ªsessionç‹¬å ä¸€ä¸ªæµè§ˆå™¨ï¼Œæµè§ˆå™¨æ²¡æœ‰å…³é—­ï¼Œè¿™ä¸ªsessionå°±ä¸€ç›´å­˜åœ¨
- ç”¨æˆ·ç™»å…¥ä¹‹åï¼Œæ•´ä¸ªç½‘ç«™éƒ½å¯ä»¥è®¿é—®ï¼ˆä¿å­˜ç”¨æˆ·çš„ä¿¡æ¯ï¼‰

> sessionå’Œcookieçš„åŒºåˆ«

- CookieæŠŠç”¨æˆ·çš„æ•°æ®å†™ç»™ç”¨æˆ·çš„æµè§ˆå™¨ï¼Œæµè§ˆå™¨ä¿å­˜ï¼ˆå¯ä»¥ä¿å­˜å¤šä¸ªï¼‰
- SessionæŠŠç”¨æˆ·çš„æ•°æ®å†™åˆ°ç”¨æˆ·ç‹¬å çš„Sessionä¸­ï¼ŒæœåŠ¡å™¨ç«¯ä¿å­˜ï¼ˆä¿å­˜é‡è¦çš„ä¿¡æ¯ï¼Œå‡å°‘æœåŠ¡å™¨èµ„æºçš„æµªè´¹ï¼‰
- Sessionå¯¹è±¡ç”±æœåŠ¡å™¨åˆ›å»º 

> ä½¿ç”¨åœºæ™¯

- ä¿å­˜ç”¨æˆ·ç™»å…¥çš„ä¿¡æ¯
- è´­ç‰©è½¦ä¿¡æ¯
- åœ¨æ•´ä¸ªç½‘ç«™ä¸­ç»å¸¸ä¼šä½¿ç”¨çš„æ•°æ®ï¼Œä¿å­˜åœ¨Sessionä¸­       

```java
public class SessionDemo01 extends HttpServlet {
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
       //è§£å†³ä¹±ç é—®é¢˜
       req.setCharacterEncoding("utf-8");
       resp.setCharacterEncoding("utf-8");
       resp.setContentType("text/html;charset=utf-8");
       //è·å–session
        HttpSession session = req.getSession();
        //åœ¨sessionä¸­å­˜å…¥ä¿¡æ¯
        session.setAttribute("name",new Person("å¼ ä¸‰",19));
        if(session.isNew()){
            resp.getWriter().write("è¿™ä¸ªsessionæ˜¯æ–°åˆ›å»ºçš„ï¼Œ"+session.getId());
        }else {
            resp.getWriter().write("è¿™ä¸ªsessionæ˜¯å·²ç»å­˜åœ¨çš„ï¼Œ"+session.getId());
        }
    }
    /*
    Sessionåˆ›å»ºæ—¶ï¼š
        Cookie cookie = new Cookie("JSESSIONID"ï¼ŒsessionId);
        resp.addCookie(cookie);
     */
```

```java
public class SessionDemo02 extends HttpServlet {
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        //è§£å†³ä¹±ç é—®é¢˜
        req.setCharacterEncoding("utf-8");
        resp.setCharacterEncoding("utf-8");
        resp.setContentType("text/html;charset=utf-8");
        //è·å¾—Session
        HttpSession session = req.getSession();
        Person name = (Person) session.getAttribute("name");
        System.out.println(name);
    }
```

Sessionè‡ªåŠ¨è¿‡æœŸï¼Œåœ¨web.xmlä¸­è®¾ç½®

```xml
     <!--è®¾ç½®Sessioné»˜è®¤çš„å¤±æ•ˆæ—¶é—´-->
    <session-config>
        <!--15åˆ†é’ŸåSessionè‡ªåŠ¨å¤±æ•ˆï¼Œä»¥åˆ†é’Ÿä¸ºå•ä½-->
        <session-timeout>15</session-timeout>
    </session-config>
```

## 7.jsp

### 7.1ä»€ä¹ˆæ˜¯jsp

Java Server Pages :JavaæœåŠ¡ç«¯é¡µé¢ï¼Œä¹Ÿå’ŒServletä¸€æ ·ï¼Œç”¨äºåŠ¨æ€webæŠ€æœ¯

> ç‰¹ç‚¹

- å†™jspå°±åƒæ˜¯åœ¨å†™HTML
- åŒºåˆ«ï¼š
  - htmlåªç»™ç”¨æˆ·æä¾›é™æ€çš„æ•°æ®
  - jspé¡µé¢ä¸­å¯ä»¥åµŒå…¥javaä»£ç ï¼Œä¸ºç”¨æˆ·æä¾›åŠ¨æ€æ•°æ®

### 7.2.jspåŸç†

![image-20210119232033278](./images/image-20210119232033278.png)

é€šè¿‡æŸ¥çœ‹æ–‡ä»¶å‘ç°é¡µé¢è½¬åŒ–ä¸ºjavaç¨‹åº

**æµè§ˆå™¨å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œä¸ç®¡è®¿é—®ä»€ä¹ˆèµ„æºï¼Œå…¶å®éƒ½æ˜¯åœ¨è®¿é—®Servlet**

**jspæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªServlet**

```java
//åˆå§‹åŒ– 
public void _jspInit() {);
  }
//é”€æ¯
  public void _jspDestroy() {
  }
//JSPService
public void _jspService(final javax.servlet.http.HttpServletRequest request, final javax.servlet.http.HttpServletResponse response)
        throws java.io.IOException, javax.servlet.ServletException 
```

1.åˆ¤æ–­è¯·æ±‚

2.å†…ç½®ä¸€äº›å¯¹è±¡

```java
    final javax.servlet.jsp.PageContext pageContext;			//é¡µé¢ä¸Šä¸‹æ–‡
    javax.servlet.http.HttpSession session = null;				 //session
    final javax.servlet.ServletContext application;				   //application
    final javax.servlet.ServletConfig config;					//config
    javax.servlet.jsp.JspWriter out = null;						//out
    final java.lang.Object page = this;						    //page:å½“å‰é¡µ
    HttpServletRequest request							   //è¯·æ±‚
    HttpServletResponse reponse							  //å“åº”
```

3.è¾“å‡ºé¡µé¢å‰å¢åŠ çš„ä»£ç 

```java
      response.setContentType("text/html;charset=UTF-8");
      pageContext = _jspxFactory.getPageContext(this, request, response,
      			null, true, 8192, true);
      _jspx_page_context = pageContext;
      application = pageContext.getServletContext();
      config = pageContext.getServletConfig();
      session = pageContext.getSession();
      out = pageContext.getOut();
      _jspx_out = out;
```

### 7.3.JSPåŸºç¡€è¯­æ³•

#### jspè¡¨è¾¾å¼

```jsp
  <%--JSPè¡¨è¾¾å¼
  ä½œç”¨ï¼šç”¨æ¥å°†ç¨‹åºçš„è¾“å‡ºï¼Œè¾“å‡ºåˆ°å®¢æˆ·ç«¯
  <%= å˜é‡æˆ–è€…è¡¨è¾¾å¼%>
  --%>
  <%= new java.util.Date()%>
```

#### jspè„šæœ¬ç‰‡æ®µ

```jsp
  <%--JSPè„šæœ¬ç‰‡æ®µ--%>
  <%
    int sum = 0;
    for(int i=0;i<=100;i++){
      sum+=i;
    }
    out.println("<h1>Sum="+sum+"</h1>");
  %>                         
```

**å†å®ç°**

```jsp
  <%--åœ¨ä»£ç åµŒå…¥htmlå…ƒç´ --%>
  <%
    for(int i=0;i<5;i++){
      %>
  <h1>Hello World<%=i%></h1>
  <%
    }
  %>
```

#### JSPå£°æ˜

jspå£°æ˜ï¼šä¼šè¢«ç¼–è¯‘åˆ°jspç”ŸæˆJavaç±»ä¸­ï¼Œå…¶ä»–ä¼šè¢«ç”Ÿæˆåˆ°jspserviceæ–¹æ³•ä¸­

```jsp
<%%>
<%=%>
<%!%>
<%--æ³¨é‡Š--%>
```

### 7.4.JSPæŒ‡ä»¤

```jsp
<%@ page ....>

<%--@includeä¼šå°†ä¸¤ä¸ªé¡µé¢åˆäºŒä¸ºä¸€ï¼Œå½“ä½œä¸€ä¸ªé¡µé¢è¾“å‡º--%>
    <%@include file="common/header.jsp"%>
    <h1>ç½‘é¡µä¸»ä½“</h1>
    <%@include file="common/footer.jsp"%>
<%--jsp:includeæœ¬è´¨æ˜¯æ‹¼æ¥é¡µé¢ï¼Œè¿˜æ˜¯3ä¸ªé¡µé¢--%>
<jsp:include page="common/header.jsp"/>
<h1>ç½‘é¡µä¸»ä½“</h1>
<jsp:include page="common/footer.jsp"/>
```

### 7.5.        

- PageContextï¼šé€šè¿‡è¯¥å¯¹è±¡å¯ä»¥è·å–å…¶ä»–å¯¹è±¡
- Requestï¼šå°è£…å®¢æˆ·ç«¯çš„è¯·æ±‚
- Responseï¼šå°è£…æœåŠ¡å™¨å¯¹å®¢æˆ·ç«¯çš„å“åº”
- Sessionï¼šå°è£…ç”¨æˆ·ä¼šè¯
- Applicationï¼šå°è£…æœåŠ¡å™¨è¿è¡Œç¯å¢ƒçš„å¯¹è±¡
- configï¼šWebåº”ç”¨çš„é…ç½®å¯¹è±¡
- outï¼šè¾“å‡ºæœåŠ¡å™¨å“åº”çš„è¾“å‡ºæµå¯¹è±¡
- pageï¼šJSPé¡µé¢æœ¬èº«
- exception ï¼šå°è£…é¡µé¢æŠ›å‡ºå¼‚å¸¸çš„å¯¹è±¡

```javascript
<%--å†…ç½®å¯¹è±¡--%>
<%
    pageContext.setAttribute("name1","1hao");//ä¿å­˜çš„æ•°æ®åªåœ¨ä¸€ä¸ªé¡µé¢ä¸­æœ‰æ•ˆ
    request.setAttribute("name2","2hao");//ä¿å­˜çš„æ•°æ®åªåœ¨ä¸€æ¬¡è¯·æ±‚ä¸­æœ‰æ•ˆï¼Œè¯·æ±‚è½¬å‘ä¼šæºå¸¦è¿™ä¸ªæ•°æ®
    session.setAttribute("name3","3hao");//ä¿å­˜çš„æ•°æ®åªåœ¨ä¸€æ¬¡ä¼šè¯ä¸­æœ‰æ•ˆï¼Œä»æ‰“å¼€æµè§ˆå™¨åˆ°å…³é—­æµè§ˆå™¨
    application.setAttribute("name4","4hao");//ä¿å­˜çš„æ•°æ®åœ¨æœåŠ¡å™¨ä¸­æœ‰æ•ˆï¼Œä»æ‰“å¼€æœåŠ¡å™¨åˆ°å…³é—­æœåŠ¡å™¨
%>

<%
    //ä»pageContextå–å‡ºï¼Œé€šè¿‡å¯»æ‰¾æ–¹å¼
    String name1 = (String)pageContext.findAttribute("name1");
    String name2 = (String)pageContext.findAttribute("name2");
    String name3 = (String)pageContext.findAttribute("name3");
    String name4 = (String)pageContext.findAttribute("name4");
    String name5 = (String)pageContext.findAttribute("name5");//ä¸å­˜åœ¨

%>

<%--ä½¿ç”¨Elè¡¨è¾¾å¼è¾“å‡º ${}--%>
<h1>å–å‡ºçš„å€¼ä¸ºï¼š</h1>
<h3>${name1}</h3>
<h3>${name2}</h3>
<h3>${name3}</h3>
<h3>${name4}</h3>
<h3><%=name5%></h3>
```

### 7.6.JSPæ ‡ç­¾ï¼ŒJSTLæ ‡ç­¾ï¼ŒELè¡¨è¾¾å¼

```xml
        <!--JSTLè¡¨è¾¾å¼çš„ä¾èµ–-->
        <!-- https://mvnrepository.com/artifact/javax.servlet.jsp.jstl/jstl-api -->
        <dependency>
            <groupId>javax.servlet.jsp.jstl</groupId>
            <artifactId>jstl-api</artifactId>
            <version>1.2</version>
        </dependency>
        <!--standardæ ‡ç­¾åº“-->
        <!-- https://mvnrepository.com/artifact/taglibs/standard -->
        <dependency>
            <groupId>taglibs</groupId>
            <artifactId>standard</artifactId>
            <version>1.1.2</version>
        </dependency>
```

#### ELè¡¨è¾¾å¼ï¼š`${}`

- è·å–æ•°æ®
- æ‰§è¡Œè¿ç®—
- è·å–webå¼€å‘çš„å¸¸ç”¨å¯¹è±¡

#### JSPæ ‡ç­¾

```jsp
<%--http://localhost:8080jsptag.jsp?name=å¼ ä¸‰&age=18--%>
<jsp:forward page="jsptag2.jsp">
    <jsp:param name="name" value="zz"/>
    <jsp:param name="age" value="18"/>
</jsp:forward>
```

#### JSTLè¡¨è¾¾å¼

JSTLæ ‡ç­¾åº“çš„ä½¿ç”¨æ˜¯ä¸ºäº†å¼¥è¡¥HTMLæ ‡ç­¾çš„ä¸è¶³ï¼›

![image-20210126220012762](./images/image-20210126220012762.png)

**JSTLæ ‡ç­¾ä½¿ç”¨æ­¥éª¤**

- å¼•å…¥å¯¹åº”çš„taglib
- ä½¿ç”¨å…¶ä¸­çš„æ–¹æ³•
- **tomcatä¸­ä¹Ÿéœ€è¦å¯¼å…¥jaråŒ…ï¼ŒæŠ¥é”™**

```jsp
<body>
<h4>ifæµ‹è¯•</h4>
<form action="coreif.jsp" method="get">
    <%--ELè¡¨è¾¾å¼è·å–è¡¨å•ä¸­çš„æ•°æ®
        ${param.å‚æ•°å}
    --%>
    <input type="text" name="username" value="${param.username}">
        <input type="submit" value="ç™»å…¥">
</form>
<%--åˆ¤æ–­æäº¤çš„ç”¨æˆ·åæ˜¯å¦ä¸ºç®¡ç†å‘˜ï¼Œç™»å…¥æˆåŠŸ--%>
<c:if test="${param.username=='admin'}" var="isAdmin">
    <c:out value="ç®¡ç†å‘˜æ¬¢è¿ä½ "/>
</c:if>
<c:out value="${isAdmin}"/>
</body>
```

```jsp
<%--å®šä¹‰ä¸€ä¸ªå˜é‡scope,å€¼ä¸º85--%>
<c:set var="scope" value="85"/>

<c:choose>
    <c:when test="${scope>=90}">ä½ çš„æˆç»©ä¸ºä¼˜ç§€</c:when>
    <c:when test="${scope>=80}">ä½ çš„æˆç»©ä¸ºè‰¯å¥½</c:when>
    <c:when test="${scope>=70}">ä½ çš„æˆç»©ä¸ºä¸€èˆ¬</c:when>
    <c:when test="${scope>=60}">ä½ çš„æˆç»©ä¸ºè¿˜è¡Œ</c:when>
</c:choose>
```

```jsp
<body>
<%
    ArrayList<String> people = new ArrayList<>();
    people.add(0,"å¼ ä¸‰");
    people.add(1,"æå››");
    people.add(2,"ç‹äº”");
    people.add(3,"èµµå…­");
    people.add(4,"è€ä¸ƒ");
    request.setAttribute("list",people);
%>
<%--
    var:æ¯ä¸€æ¬¡éå†å‡ºæ¥çš„å˜é‡
--%>
<c:forEach var="people" items="${list}">
    <c:out value="${people}"/>
</c:forEach>

<c:forEach var="people" items="${list}" begin="1" end="3" step="2">
    <c:out value="${people}"/>
</c:forEach>
</body>
```

## 8.JavaBean

å®ä½“ç±»

JavaBeanæœ‰ç‰¹å®šçš„å†™æ³•ï¼š
- å¿…é¡»è¦æœ‰ä¸€ä¸ªæ— å‚æ„é€ 
- å±æ€§å¿…é¡»ç§æœ‰åŒ–
- å¿…é¡»è¦æœ‰å¯¹åº”çš„get/setæ–¹æ³•

ä¸€èˆ¬ç”¨æ¥å’Œæ•°æ®åº“çš„å­—æ®µåšæ˜ å°„ ORM;
ORM:å¯¹è±¡å…³ç³»æ˜ å°„
- è¡¨-----ç±»
- å­—æ®µ----å±æ€§
- è¡Œè®°å½•---å¯¹è±¡

**peopleè¡¨**

| id | name | age | adress |
| ---- | ---- | ---- | ---- |
| 1 | 1å·    | 11 | ssad |
| 2 | 2å· | 12 | sss |
| 3 | 3å· | 13 | ssss |

å¯¹åº”çš„ç±»

```java
class People{
    private int id;
    private String name;
    private int age;
    private String adress;
}
```

```jsp
<%
//    People people = new People();
//    people.setId(18);
//    people.setAge(18);
//    people.setName("xhh");
//    people.setAddress("jsxncs");
%>
<jsp:useBean id="people" class="com.xhh.pojo.People" scope="page"/>
<jsp:setProperty name="people" property="id" value="18"/>
<jsp:setProperty name="people" property="age" value="18"/>
<jsp:setProperty name="people" property="name" value="xhh"/>
<jsp:setProperty name="people" property="address" value="jsxncs"/>

idï¼š<jsp:getProperty name="people" property="id"/>
å§“åï¼š<jsp:getProperty name="people" property="name"/>
å¹´é¾„ï¼š<jsp:getProperty name="people" property="age"/>
ä½å€ï¼š<jsp:getProperty name="people" property="address"/>
```

## 9.MVCä¸‰å±‚æ¶æ„

ä»€ä¹ˆæ˜¯MVC:Model  view Controller æ¨¡å‹ï¼Œè§†å›¾ï¼Œæ§åˆ¶å™¨

![image-20210130202019920](./images/image-20210130202019920.png)

Model

- ä¸šåŠ¡å¤„ç†ï¼šä¸šåŠ¡é€»è¾‘(Service)
- æ•°æ®æŒä¹…å±‚:CRUD(DAO)

View

- å±•ç¤ºæ•°æ®
- æä¾›é“¾æ¥å‘èµ·Servletè¯·æ±‚

Controller(Servlet)
- æ¥æ”¶ç”¨æˆ·è¯·æ±‚
- äº¤ç»™ä¸šåŠ¡å±‚å¤„ç†å¯¹åº”çš„ä»£ç 
- æ§åˆ¶è§†å›¾çš„è·³è½¬

```java
ç™»å…¥--->æ¥æ”¶ç”¨æˆ·çš„ç™»å…¥è¯·æ±‚--->å¤„ç†ç”¨æˆ·çš„è¯·æ±‚ï¼ˆè·å–ç”¨æˆ·ç™»å…¥çš„å‚æ•°,username,passwordï¼‰--->äº¤ç»™ä¸šåŠ¡å±‚å¤„ç†ç™»å…¥ä¸šåŠ¡ï¼ˆåˆ¤æ–­ç”¨æˆ·åå¯†ç æ˜¯å¦æ­£ç¡®ï¼‰--->Daoå±‚æŸ¥è¯¢ç”¨æˆ·åå’Œå¯†ç æ˜¯å¦æ­£ç¡®
```

## 10.Filter
Filter:è¿‡æ»¤å™¨ï¼Œç”¨æ¥è¿‡æ»¤ç½‘ç«™çš„æ•°æ®
- å¤„ç†ä¸­æ–‡ä¹±ç 
- ç™»å…¥éªŒè¯...

Filterå¼€å‘æ­¥éª¤ï¼š
- å¯¼å…¥mavenä¾èµ–
- ç¼–å†™è¿‡æ»¤å™¨

å®ç°Filter,é‡å†™æ–¹æ³•

```java
    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {
        servletRequest.setCharacterEncoding("utf-8");
        servletResponse.setCharacterEncoding("utf-8");
        servletResponse.setContentType("text/html;charset=UTF-8");
        /**
         * 1.è¿‡æ»¤æ‰€æœ‰çš„ä»£ç ï¼Œåœ¨è¿‡æ»¤ç‰¹å®šè¯·æ±‚æ—¶éƒ½ä¼šæ‰§è¡Œ
         * 2.å¿…é¡»è¦è®©è¿‡æ»¤å™¨ç»§ç»­æ‰§è¡Œ
         */
        System.out.println("å‰");
        filterChain.doFilter(servletRequest,servletResponse);//è®©è¯·æ±‚ç»§ç»­æ‰§è¡Œ
        System.out.println("å");
    }
```
- åœ¨web.xmlä¸­é…ç½®Filter

```xml
    <filter>
        <filter-name>CharacterEncodingFilter</filter-name>
        <filter-class>com.xhh.filter.CharacterEncodingFilter</filter-class>
    </filter>
    <filter-mapping>
        <filter-name>CharacterEncodingFilter</filter-name>
        <!--åªè¦æ˜¯/servletä¸‹çš„ä»»ä½•è¯·æ±‚éƒ½ä¼šç»è¿‡è¿™ä¸ªè¿‡æ»¤å™¨-->
        <url-pattern>/servlet/*</url-pattern>
    </filter-mapping>
```

## 11.ç›‘å¬å™¨

```java
//ç»Ÿè®¡ç½‘ç«™åœ¨çº¿äººæ•°ï¼šç»Ÿè®¡session
public class OnlineCountListener implements HttpSessionListener {
    //åˆ›å»ºSessionç›‘å¬
    public void sessionCreated(HttpSessionEvent httpSessionEvent) {
        ServletContext servletContext = httpSessionEvent.getSession().getServletContext();
        Integer onlineCount = (Integer)servletContext.getAttribute("OnlineCount");
        if(onlineCount==null){
            onlineCount = new Integer(1);
        }else{
            int count = onlineCount.intValue();
            onlineCount = new Integer(count+1);
        }
        servletContext.setAttribute("OnlineCount",onlineCount);
    }
//é”€æ¯
    public void sessionDestroyed(HttpSessionEvent httpSessionEvent) {
        ServletContext servletContext = httpSessionEvent.getSession().getServletContext();
        Integer onlineCount = (Integer)servletContext.getAttribute("OnlineCount");
        if(onlineCount==null){
            onlineCount = new Integer(0);
        }else{
            int count = onlineCount.intValue();
            onlineCount = new Integer(count-1);
        }
        servletContext.setAttribute("OnlineCount",onlineCount);
    }
}
```

web.xmlä¸­æ³¨å†Œç›‘å¬å™¨

```xml
    <!--æ³¨å†Œç›‘å¬å™¨-->
    <listener>
        <listener-class>com.xhh.listener.OnlineCountListener</listener-class>
    </listener>
```

## 12.è¿‡æ»¤å™¨ï¼Œç›‘å¬å™¨å¸¸è§åº”ç”¨
> ç›‘å¬å™¨ï¼šGUIï¼ˆå›¾å½¢ç•Œé¢ï¼‰ç¼–ç¨‹ä¸­ç»å¸¸ä½¿ç”¨

> ç”¨æˆ·ç™»å…¥ä¹‹åæ‰èƒ½è¿›å…¥ä¸»é¡µï¼ç”¨æˆ·æ³¨é”€åä¸èƒ½è¿›å…¥ä¸»é¡µ

- ç”¨æˆ·ç™»å…¥ä¹‹åï¼Œå‘Sessionä¸­æ”¾å…¥ç”¨æˆ·çš„æ•°æ®
```java
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        String username = req.getParameter("username");
        if(username.equals("admin")){//ç™»å…¥æˆåŠŸ
            req.getSession().setAttribute("USER_SESSION",req.getSession().getId());
            resp.sendRedirect("/sys/success.jsp");
        }else {
            resp.sendRedirect("/error.jsp");
        }
    }
```

- è¿›å…¥ä¸»é¡µæ—¶åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç™»å…¥ï¼›è¿‡æ»¤å™¨å®ç°

```java
   public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {
        HttpServletRequest  request = (HttpServletRequest)servletRequest;
        HttpServletResponse response = (HttpServletResponse)servletResponse;

        if(request.getSession().getAttribute("USER_SESSION")==null){
            response.sendRedirect("/login.jsp");
        }
        filterChain.doFilter(servletRequest,servletResponse);
    }
```

## 13.JDBCå¤ä¹ 

éœ€è¦çš„jaråŒ…ï¼š

- java.sql
- javax.sql
- mysql-connector-java...

å®éªŒç¯å¢ƒæ­å»º

- æ–°å»ºSQLè¡¨

```sql
CREATE TABLE `users` (
  `id` int(6) NOT NULL DEFAULT '0',
  `name` varchar(20) DEFAULT NULL,
  `password` varchar(40) DEFAULT NULL,
  `email` varchar(40) DEFAULT NULL,
  `birthday` date DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8
```

- ä»£ç å®ç°

```java
public class TestJdbc {
    public static void main(String[] args) throws ClassNotFoundException, SQLException {
        //é…ç½®ä¿¡æ¯
        String url = "jdbc:mysql://localhost:3306/jdbc?useUnicode=true&characterEncoding=utf-8";
        String username = "root";
        String password = "xhh1999.02.10";

        //åŠ è½½é©±åŠ¨
        Class.forName("com.mysql.jdbc.Driver");
        //è¿æ¥æ•°æ®åº“
        Connection connection = DriverManager.getConnection(url, username, password);
        //å‘æ•°æ®åº“å‘é€SQLçš„å¯¹è±¡Statement:CRUD
        Statement statement = connection.createStatement();
        //ç¼–å†™SQLè¯­å¥
        String sql="select * from users";
        //æ‰§è¡ŒSQL
        ResultSet resultSet = statement.executeQuery(sql);
        while (resultSet.next()){
            System.out.println("id="+resultSet.getObject("id"));
            System.out.println("name="+resultSet.getObject("name"));
            System.out.println("password="+resultSet.getObject("password"));
            System.out.println("email="+resultSet.getObject("email"));
            System.out.println("birthday="+resultSet.getObject("birthday"));
        }
        //å…³é—­è¿æ¥ï¼Œé‡Šæ”¾èµ„æº(å…ˆå¼€åå…³)
        resultSet.close();
        statement.close();
        connection.close();
    }
}
```

# é¡¹ç›®æ­å»º

- æ­å»ºMavené¡¹ç›®ï¼Œé…ç½®Tomcat
- å¯¼å…¥JaråŒ…
- åˆ›å»ºé¡¹ç›®åŒ…ç»“æ„

![1613022441585](./images/1613022441585.png)

- ç¼–å†™å®ä½“ç±»

  ORMæ˜ å°„ï¼šè¡¨-ç±»æ˜ å°„

- ç¼–å†™åŸºç¡€å…¬å…±ç±»

  - æ•°æ®åº“é…ç½®æ–‡ä»¶

  ```properties
  driver=com.mysql.jdbc.Driver
  url=jdbc:mysql://localhost:3306/smbms?useUnicode=true&characterEncoding=utf-8
  username=root
  password=xhh1999.02.10
  ```

  - ç¼–å†™æ•°æ®åº“çš„å…¬å…±ç±»

```java
package com.xhh.dao;

import java.io.IOException;
import java.io.InputStream;
import java.sql.*;
import java.util.Properties;

/**
 * @author xhh
 * @date 2021/2/10 16:53
 */
//æ“ä½œæ•°æ®åº“çš„å…¬å…±ç±»
public class BaseDao {
    private static String driver;
    private static String url;
    private static String username;
    private static String password;
    //é™æ€ä»£ç å—ï¼Œç±»åŠ è½½æ—¶å°±è¢«åˆå§‹åŒ–
    static {
        Properties properties = new Properties();
        //é€šè¿‡å¯¹åº”çš„ç±»åŠ è½½å™¨è¯»å–å¯¹åº”çš„èµ„æº
        InputStream resourceAsStream = BaseDao.class.getClassLoader().getResourceAsStream("db.properties");
        try {
            properties.load(resourceAsStream);
        } catch (IOException e) {
            e.printStackTrace();
        }
        driver = properties.getProperty("driver");
        url = properties.getProperty("url");
        username = properties.getProperty("username");
        password = properties.getProperty("password");
    }
    //è·å–æ•°æ®åº“çš„è¿æ¥
    public static Connection getConnection(){
        Connection connection = null;
        try {
            Class.forName(driver);
            connection = DriverManager.getConnection(url,username,password);
        } catch (Exception e) {
            e.printStackTrace();
        }
        return connection;
    }
    //ç¼–å†™æŸ¥è¯¢å…¬å…±ç±»
    public static ResultSet execute(Connection connection, String sql, Object[] params, ResultSet resultSet, PreparedStatement preparedStatement) throws SQLException {
        preparedStatement = connection.prepareStatement(sql);

        for(int i=1;i<params.length;i++){
            preparedStatement.setObject(i+1,params[i]);
        }

        resultSet = preparedStatement.executeQuery(sql);
        return resultSet;
    }
    //ç¼–å†™å¢åˆ æ”¹å…¬å…±æ–¹æ³•
    public static int execute(Connection connection, String sql, Object[] params,PreparedStatement preparedStatement) throws SQLException {
        preparedStatement = connection.prepareStatement(sql);

        for(int i=1;i<params.length;i++){
            preparedStatement.setObject(i+1,params[i]);
        }

        int updateRows = preparedStatement.executeUpdate(sql);
        return updateRows;
    }
    //é‡Šæ”¾èµ„æº
    public static boolean closeResource(Connection connection,PreparedStatement preparedStatement,ResultSet resultSet){
        boolean flag = true;
        if(resultSet!=null){
            try {
                resultSet.close();
                //GCå›æ”¶
                resultSet = null;
            } catch (SQLException e) {
                e.printStackTrace();
                flag = false;
            }
        }

        if(preparedStatement!=null){
            try {
                preparedStatement.close();
                preparedStatement = null;
            } catch (SQLException e) {
                e.printStackTrace();
                flag = false;
            }
        }

        if(connection!=null){
            try {
                connection.close();
                connection = null;
            } catch (SQLException e) {
                e.printStackTrace();
                flag = false;
            }
        }
        return flag;
    }
}
```

- ç¼–å†™è¿‡æ»¤å™¨

```java

    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {
        servletRequest.setCharacterEncoding("utf-8");
        servletResponse.setCharacterEncoding("utf-8");
        servletResponse.setContentType("text/html;charset=utf-8");

        filterChain.doFilter(servletRequest,servletResponse);
    }
```

- å¯¼å…¥é™æ€èµ„æº

# ç™»å…¥åŠŸèƒ½å®ç°

![1613025305617](./images/1613025305617.png)

1.ç¼–å†™å‰ç«¯é¡µé¢

2.è®¾ç½®é¦–é¡µ

```xml
    <!--è®¾ç½®æ¬¢è¿é¡µé¢-->
    <welcome-file-list>
        <welcome-file>login.jsp</welcome-file>
    </welcome-file-list>
```

3.ç¼–å†™daoå±‚ç™»å…¥ç”¨æˆ·çš„æ¥å£

```java
    //å¾—åˆ°è¦ç™»å…¥çš„ç”¨æˆ·
    public User getLoginUser(Connection connection,String userCode);
```

4.ç¼–å†™daoæ¥å£çš„å®ç°ç±»

```java
public class UserDaoImpl implements UserDao {
    public User getLoginUser(Connection connection, String userCode) {
        PreparedStatement preparedStatement = null;
        ResultSet resultSet = null;
        User user = null;

        if(connection!=null){
            String sql = "select * from user where userCode=?";
            Object[] params = {userCode};
            try {
                resultSet = BaseDao.execute(connection,sql,params,resultSet,preparedStatement);
                if(resultSet.next()){
                    user = new User();
                    user.setId(resultSet.getInt("id"));
                    user.setUserCode(resultSet.getString("userCode"));
                    user.setUserName(resultSet.getString("userName"));
                    user.setUserPassword(resultSet.getString("userPassword"));
                    user.setGender(resultSet.getInt("gender"));
                    user.setBirthday(resultSet.getDate("birthday"));
                    user.setPhone(resultSet.getString("phone"));
                    user.setAddress(resultSet.getString("address"));
                    user.setUserRole(resultSet.getInt("userRole"));
                    user.setCreatedBy(resultSet.getInt("createdBy"));
                    user.setCreationDate(resultSet.getTimestamp("creationDate"));
                    user.setModifyBy(resultSet.getInt("modifyBy"));
                    user.setModifyDate(resultSet.getTimestamp("modifyDate"));
                }
                BaseDao.closeResource(connection,preparedStatement,resultSet);
            } catch (SQLException e) {
                e.printStackTrace();
            }
        }
        return user;
    }
} 
```


5.ä¸šåŠ¡å±‚æ¥å£

```java
    //ç”¨æˆ·ç™»å…¥
    public User login(String userCode,String password);
```
6.ä¸šåŠ¡å±‚å®ç°ç±»

```java
public class UserServiceImpl implements UserService {
    //ä¸šåŠ¡å±‚ä¼šè°ƒç”¨daoå±‚ï¼Œéœ€è¦å¼•å…¥Daoå±‚
    //private UserDao userDao = new UserDaoImpl();
    private UserDao userDao;
    public UserServiceImpl(){
        userDao = new UserDaoImpl();
    }

    public User login(String userCode, String password) {
        Connection connection = BaseDao.getConnection();;
        User user = userDao.getLoginUser(connection, userCode);
        BaseDao.closeResource(connection,null,null);
        return user;
    }
}
```

7.ç¼–å†™Servlet

```java
    //Servlet:æ§åˆ¶å±‚ï¼Œè°ƒç”¨ä¸šåŠ¡å±‚ä»£ç 
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        System.out.println("loginServlet--start");

        //è·å–ç”¨æˆ·åå’Œå¯†ç 
        String userCode = req.getParameter("userCode");
        String userPassword = req.getParameter("userPassword");

        //å’Œæ•°æ®åº“ä¸­çš„å¯†ç è¿›è¡Œå¯¹æ¯”ï¼Œè°ƒç”¨ä¸šåŠ¡å±‚
        UserServiceImpl userService = new UserServiceImpl();
        User login = userService.login(userCode, userPassword);
        if(login!=null){
            //å°†ç”¨æˆ·çš„ä¿¡æ¯æ”¾å…¥åˆ°Sessionä¸­
            req.getSession().setAttribute(Constants.USER_SESSION,login);
            //è·³è½¬åˆ°ä¸»é¡µ
            resp.sendRedirect("jsp/frame.jsp");
        }else {
            //è½¬å‘å›ç™»å…¥é¡µé¢ï¼Œæç¤ºç”¨æˆ·åæˆ–å¯†ç é”™è¯¯
            req.setAttribute("error","ç”¨æˆ·åæˆ–è€…å¯†ç é”™è¯¯");
            req.getRequestDispatcher("login.jsp").forward(req,resp);
        }
    }
```

8.æ³¨å†ŒServlet,æµ‹è¯•è®¿é—®ï¼Œç¡®ä¿ä»¥ä¸ŠåŠŸèƒ½æˆåŠŸ



# ç™»å…¥åŠŸèƒ½ä¼˜åŒ–

æ³¨é”€åŠŸèƒ½å®ç°
```java
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        req.getSession().removeAttribute(Constants.USER_SESSION);
        resp.sendRedirect(req.getContextPath()+"/login.jsp");//è¿”å›ç™»å…¥é¡µé¢
    }
```
#ç™»å…¥æ‹¦æˆª

ç¼–å†™è¿‡æ»¤å™¨

```java
    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {
        HttpServletRequest request = (HttpServletRequest)servletRequest;
        HttpServletResponse response = (HttpServletResponse)servletResponse;

        //è¿‡æ»¤å™¨ä»Sessionä¸­è·å–ç”¨æˆ·
        User user = (User)request.getSession().getAttribute(Constants.USER_SESSION);
        if(user==null){ //è¯´æ˜ç”¨æˆ·æ²¡æœ‰ç™»å…¥æˆ–è€…å·²ç»æ³¨é”€
            response.sendRedirect("/smbms/error.jsp");
        }else {
            filterChain.doFilter(servletRequest,servletResponse);
        }
    }
```

æ³¨å†Œï¼Œæµ‹è¯•åŠŸèƒ½

# å¯†ç ä¿®æ”¹
1.å¯¼å…¥å‰ç«¯ç´ æ
2.ç¼–å†™daoå±‚

```java
    public int updatePwd(Connection connection, int id, String password) {
        PreparedStatement preparedStatement = null;
        int updateRow = 0;
        String sql = "update smbms_user set userPassword=? where id=?";
        Object[] params= {password,id};
        if(connection!=null){
            try {
                updateRow = BaseDao.execute(connection, sql, params, preparedStatement);
                BaseDao.closeResource(connection,preparedStatement,null);
            } catch (SQLException e) {
                e.printStackTrace();
            }
        }
        return updateRow;
    }
```
3.ç¼–å†™serviceå±‚

```java
    public boolean updatePwd(int id, String pwd) {
        Connection connection = BaseDao.getConnection();
        boolean flag = false;
        if(userDao.updatePwd(connection,id,pwd)>0){
            flag = true;
        }
        BaseDao.closeResource(connection,null,null);
        return flag;
    }
```
4.ç¼–å†™Servletå±‚

```java
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        //ä»Sessionä¸­è·å–id
        User user = (User)req.getSession().getAttribute(Constants.USER_SESSION);
        boolean flag = false;
        String newpassword = req.getParameter("newpassword");
        if(user!=null && !StringUtils.isNullOrEmpty(newpassword)){
            UserService userService = new UserServiceImpl();
            flag = userService.updatePwd(user.getId(),newpassword);
            if(flag){
                req.setAttribute("message","ä¿®æ”¹å¯†ç æˆåŠŸï¼Œè¯·ä½¿ç”¨æ–°å¯†ç ç™»å…¥");
                //ç§»é™¤Session
                req.getSession().removeAttribute(Constants.USER_SESSION);
            }else {
                req.setAttribute("message","å¯†ç ä¿®æ”¹å¤±è´¥ï¼");
            }
        }else {
            req.setAttribute("message","æ–°å¯†ç å‡ºç°é—®é¢˜");
        }
        req.getRequestDispatcher("pwdmodify.jsp").forward(req,resp);
    }
```

å®ç°Servletçš„å¤ç”¨
```java
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        String method = req.getParameter("method");
        if(method.equals("savepwd")){
            this.updatePwd(req, resp);
        }
    }
```
## ä¼˜åŒ–å¯†ç ä¿®æ”¹ä½¿ç”¨Ajax
1.ä½¿ç”¨fastjsonï¼Œå¯¼å…¥é˜¿é‡Œå·´å·´çš„jaråŒ…

```xml
        <!-- https://mvnrepository.com/artifact/com.alibaba/fastjson -->
        <dependency>
            <groupId>com.alibaba</groupId>
            <artifactId>fastjson</artifactId>
            <version>1.2.61</version>
        </dependency>
```

2.ç¼–å†™ä»£ç 

```java
   //éªŒè¯æ—§å¯†ç ,ä»sessionä¸­è·å–ç”¨æˆ·å¯†ç 
    public void pwdModify(HttpServletRequest request,HttpServletResponse response){
        //è·å–Sessionä¸­ç”¨æˆ·id
        User user = (User)request.getSession().getAttribute(Constants.USER_SESSION);
        String oldpassword = request.getParameter("oldpassword");
        Map<String, String> resultMap = new HashMap<String, String>();
        if(user==null){//Sessionå¤±æ•ˆ
            resultMap.put("result","sessionerror");
        }else if(StringUtils.isNullOrEmpty(oldpassword)){
            resultMap.put("result","error");
        }else {
            String userPassword = user.getUserPassword();
            if(oldpassword.equals(userPassword)){
                resultMap.put("result","true");
            }else {
                resultMap.put("result","false");
            }
        }

        try {
            response.setContentType("application/json");
            PrintWriter writer = response.getWriter();
            //JSONArray é˜¿é‡Œå·´å·´çš„JSONå·¥å…·ç±»ï¼Œè½¬æ¢æ ¼å¼
            writer.write(JSONArray.toJSONString(resultMap));
            writer.flush();
            writer.close();
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
```

3.æµ‹è¯•åŠŸèƒ½

# ç”¨æˆ·ç®¡ç†å®ç°

## 1.è·å–ç”¨æˆ·æ•°é‡

å¯¼å…¥åˆ†é¡µå·¥å…·ç±»
1.userDao

```java
    //æ ¹æ®ç”¨æˆ·åæˆ–è§’è‰²æŸ¥è¯¢ç”¨æˆ·æ€»æ•°
    public int getUserCount(Connection connection, String username, int userRole) {
        connection = BaseDao.getConnection();
        PreparedStatement preparedStatement = null;
        int count = 0;
        ResultSet resultSet = null;
        ArrayList<Object> list = new ArrayList<Object>();//å­˜æ”¾å‚æ•°

        if(connection!=null){
            StringBuffer sql = new StringBuffer();
            sql.append("select count(1) as count from smbms_user u,smbms_role r where u.userRole = r.id");
            if(!StringUtils.isNullOrEmpty(username)){
                sql.append(" and u.userName like ?");
                list.add("%"+username+"%");//index:0
            }
            if(userRole>0){
                sql.append(" and u.userRole = ?");
                list.add(userRole);//index:1
            }
            //æŠŠlistè½¬æ¢ä¸ºæ•°ç»„
            Object[] params = list.toArray();
            System.out.println("UserDaoImpl-->getUserCount"+sql.toString());//è¾“å‡ºå®Œæ•´çš„SQLè¯­å¥
            try {
                resultSet = BaseDao.execute(connection, null, null, sql.toString(), params);
                if(resultSet.next()){
                    count = resultSet.getInt("count");
                }
            } catch (SQLException e) {
                e.printStackTrace();
            }finally {
                BaseDao.closeResource(null,null,resultSet);
            }
        }
        return count;
    }
```
2.Service

```java
    public int getUserCount(String username, int userRole) {
        Connection connection = BaseDao.getConnection();
        int userCount = userDao.getUserCount(connection, username, userRole);
        BaseDao.closeResource(connection,null,null);
        return userCount;
    }
```
## 2.è·å–ç”¨æˆ·åˆ—è¡¨
1.userDaoå±‚

```java
    public List<User> getUserList(Connection connection, String userName, int userRole, int currentPageNo, int pageSize) {
        connection = BaseDao.getConnection();
        PreparedStatement preparedStatement = null;
        ResultSet resultSet = null;
        List<User> userList = new ArrayList<User>();
        if(connection!=null){
            StringBuffer sql = new StringBuffer();
            sql.append("select u.*,r.roleName as userRoleName from smbms_user u,smbms_role r where u.userRole = r.id");
            List<Object> list = new ArrayList<Object>();
            if(!StringUtils.isNullOrEmpty(userName)){
                sql.append(" and u.userName like ?");
                list.add("%"+userName+"%");//index:0
            }
            if(userRole>0){
                sql.append(" and u.userRole = ?");
                list.add(userRole);//index:1
            }
            sql.append(" order by creationDate DESC limit ?,?");
            currentPageNo = (currentPageNo-1)*pageSize;
            list.add(currentPageNo);
            list.add(pageSize);

            Object[] params = list.toArray();
            System.out.println("sql ----> " + sql.toString());
            try {
                resultSet = BaseDao.execute(connection, preparedStatement, resultSet, sql.toString(), params);
                while(resultSet.next()){
                    User user = new User();
                    user.setId(resultSet.getInt("id"));
                    user.setUserCode(resultSet.getString("userCode"));
                    user.setUserName(resultSet.getString("userName"));
                    user.setGender(resultSet.getInt("gender"));
                    user.setBirthday(resultSet.getDate("birthday"));
                    user.setPhone(resultSet.getString("phone"));
                    user.setUserRole(resultSet.getInt("userRole"));
                    user.setUserRoleName(resultSet.getString("userRoleName"));
                    userList.add(user);
                }
            } catch (SQLException e) {
                e.printStackTrace();
            }finally {
                BaseDao.closeResource(null, null, resultSet);
            }
        }
        return userList;
        }
```

2.Serviceå±‚

```java
    public List<User> getUserList(String userName, int userRole, int currentPageNo, int pageSize) {
        Connection connection = BaseDao.getConnection();
        List<User> userList = userDao.getUserList(connection, userName, userRole, currentPageNo, pageSize);
        BaseDao.closeResource(connection,null,null);
        return userList;
    }
```

## 3.è·å–è§’è‰²åˆ—è¡¨

1.Daoå±‚

```java
    public List<Role> getRoleList(Connection connection) {
        connection = BaseDao.getConnection();
        PreparedStatement preparedStatement = null;
        ResultSet resultSet = null;
        ArrayList<Role> roles = new ArrayList<Role>();
        if(connection!=null){
            String sql = "select * from smbms_role";
            Object[] params = {};
            try {
                resultSet = BaseDao.execute(connection,null,null,sql,params);
                while (resultSet.next()){
                    Role role = new Role();
                    role.setId(resultSet.getInt("id"));
                    role.setRoleName(resultSet.getString("roleName"));
                    role.setRoleCode(resultSet.getString("roleCode"));
                    roles.add(role);
                }
            } catch (SQLException e) {
                e.printStackTrace();
            }finally {
                BaseDao.closeResource(connection,null,null);
            }
        }
        return roles;
    }
```

2.Serviceå±‚

```java
    public List<Role> getRoleList() {
        Connection connection = BaseDao.getConnection();
        List<Role> roleList = roleDao.getRoleList(connection);
        BaseDao.closeResource(connection,null,null);
        return roleList;
    }
```

# æ–‡ä»¶ä¸Šä¼ 

```java
package com.xhh.servlet;

import org.apache.commons.fileupload.FileItem;
import org.apache.commons.fileupload.FileUploadException;
import org.apache.commons.fileupload.disk.DiskFileItemFactory;
import org.apache.commons.fileupload.servlet.ServletFileUpload;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.File;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.util.List;
import java.util.UUID;

/**
 * @author xhh
 * @date 2021/3/1 15:17
 */
public class FileServlet extends HttpServlet {
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        doPost(req, resp);
    }

    @Override
    protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        //åˆ¤æ–­ä¸Šä¼ çš„æ–‡ä»¶æ˜¯æ™®é€šè¡¨å•è¿˜æ˜¯æ–‡ä»¶è¡¨å•
        if(!ServletFileUpload.isMultipartContent(req)){
            return;
        }
        //åˆ›å»ºä¸Šä¼ æ–‡ä»¶çš„ä¿å­˜è·¯å¾„ï¼Œå»ºè®®åœ¨WEB-INFè·¯å¾„ä¸‹ï¼Œç”¨æˆ·æ— æ³•è®¿é—®ï¼ˆå®‰å…¨ï¼‰
        String uploadPath = this.getServletContext().getRealPath("/WEB-INF/upload");
        File uploadFile = new File(uploadPath);
        if(!uploadFile.exists()){
            uploadFile.mkdir();//åˆ›å»ºè·¯å¾„
        }

        //ç¼“å­˜ï¼Œä¸´æ—¶æ–‡ä»¶
        //ä¸´æ—¶è·¯å¾„ï¼Œå‡å¦‚æ–‡ä»¶è¶…è¿‡äº†é¢„æœŸçš„å¤§å°ï¼ŒæŠŠæ–‡ä»¶æ”¾å…¥ä¸´æ—¶æ–‡ä»¶ï¼Œå‡ å¤©ä¹‹åè‡ªåŠ¨åˆ é™¤
        String uploadTempPath = this.getServletContext().getRealPath("/WEB-INF/temp");
        File uploadTempFile = new File(uploadTempPath);
        if(!uploadTempFile.exists()){
            uploadTempFile.mkdir();//åˆ›å»ºè·¯å¾„
        }

        //å¤„ç†ä¸Šä¼ çš„æ–‡ä»¶ï¼Œä¸€èˆ¬ä½¿ç”¨æµçš„æ–¹å¼æ¥è·å–
        //ä½†æ˜¯å»ºè®®ä½¿ç”¨Apacheçš„æ–‡ä»¶ä¸Šä¼ ç»„ä»¶æ¥å®ç°ï¼Œcommon-fileupload
        /**
         * ServletFileUploadè´Ÿè´£å¤„ç†ä¸Šä¼ çš„æ–‡ä»¶æ•°æ®ï¼Œå¹¶å°†è¡¨å•ä¸­æ¯ä¸ªè¾“å…¥é¡¹å°è£…æˆä¸€ä¸ªFileItemå¯¹è±¡
         * åœ¨ä½¿ç”¨ServletFileUploadå¯¹è±¡è§£æè¯·æ±‚æ—¶éœ€è¦DisFileItemFactoryå¯¹è±¡
         *
         */
        //1.åˆ›å»ºDiskFileItemFactoryå¯¹è±¡ï¼Œå¤„ç†æ–‡ä»¶ä¸Šä¼ è·¯å¾„æˆ–è€…å¤§å°é™åˆ¶
        DiskFileItemFactory diskFileItemFactory = new DiskFileItemFactory();

        //2.è·å–ServletFileUpload
        ServletFileUpload servletFileUpload = new ServletFileUpload(diskFileItemFactory);
        servletFileUpload.setHeaderEncoding("UTF-8");

        //3.å¤„ç†ä¸Šä¼ æ–‡ä»¶
        //æŠŠå‰ç«¯è¯·æ±‚è§£æï¼Œå°è£…æˆä¸€ä¸ªFileItemå¯¹è±¡ï¼Œä»ServletFileUploadå¯¹è±¡ä¸­è·å–
        String msg=null;
        try {
            List<FileItem> fileItems = servletFileUpload.parseRequest(req);
            for (FileItem fileItem : fileItems) {
                //åˆ¤æ–­è¡¨å•
                if(fileItem.isFormField()){
                    String fieldName = fileItem.getFieldName();//å‰ç«¯è¡¨å•æ§ä»¶çš„name
                    String string = fileItem.getString("UTF-8");//å¤„ç†ä¹±ç 
                    System.out.println(fieldName+string);
                }else {//æ–‡ä»¶è¡¨å•
                    /**
                     * å¤„ç†æ–‡ä»¶
                     */
                    //æ‹¿åˆ°æ–‡ä»¶åå­—
                    String uploadFileName = fileItem.getName();
                    System.out.println("ä¸Šä¼ çš„æ–‡ä»¶å"+uploadFileName);
                    if(uploadFileName.trim().equals("") || uploadFileName==null){
                        continue;
                    }
                    //è·å–ä¸Šä¼ çš„æ–‡ä»¶å /images/girl/paojie.png
                    String fileName = uploadFileName.substring(uploadFileName.lastIndexOf("/") + 1);
                    //è·å–æ–‡ä»¶çš„åç¼€
                    String fileExtName = uploadFileName.substring(uploadFileName.lastIndexOf(".") + 1);
                    String uuidPath = UUID.randomUUID().toString();
                    //å­˜æ”¾åœ°å€
                    //æ–‡ä»¶çœŸå®å­˜åœ¨çš„è·¯å¾„
                    String realPath = uploadPath+"/"+uuidPath;
                    //ç»™æ¯ä¸ªæ–‡ä»¶åˆ›å»ºä¸€ä¸ªå¯¹åº”çš„æ–‡ä»¶å¤¹
                    File realPathFile = new File(realPath);
                    if(!realPathFile.exists()){
                        realPathFile.mkdir();
                    }
                    //æ–‡ä»¶ä¼ è¾“

                    //è·å–æ–‡ä»¶ä¸Šä¼ çš„æµ
                    InputStream inputStream = fileItem.getInputStream();
                    //åˆ›å»ºæ–‡ä»¶è¾“å‡ºæµ
                    FileOutputStream fileOutputStream = new FileOutputStream(realPath + "/" + fileName);
                    //åˆ›å»ºç¼“å†²åŒº
                    byte[] buffer = new byte[1024*1024];
                    //åˆ¤æ–­æ˜¯å¦è¯»å–å®Œæ¯•
                    int len = 0;
                    while((len=inputStream.read(buffer))>0){//è¯´æ˜è¿˜åœ¨å­˜æ•°æ®
                        fileOutputStream.write(buffer,0,len);
                    }
                    //å…³é—­æµ
                    fileOutputStream.close();
                    inputStream.close();
                    msg = "æ–‡ä»¶ä¸Šä¼ æˆåŠŸ";
                    fileItem.delete();
                }
            }
        } catch (FileUploadException e) {
            e.printStackTrace();
        }

    //Servletè¯·æ±‚è½¬å‘æ¶ˆæ¯
        req.setAttribute("msg",msg);
        req.getRequestDispatcher("info.jsp").forward(req,resp);
    }

//    public static DiskFileItemFactory getDiskFileItemFactory(File file){
//        DiskFileItemFactory diskFileItemFactory = new DiskFileItemFactory();
//        //é€šè¿‡å·¥å‚è®¾ç½®ç¼“å†²åŒºï¼Œå½“ä¸Šä¼ çš„æ–‡ä»¶å¤§äºè¿™ä¸ªç¼“å­˜åŒºçš„æ—¶å€™ï¼Œå°†ä»–æ”¾å…¥åˆ°ä¸´æ—¶æ–‡ä»¶ä¸­
//        diskFileItemFactory.setSizeThreshold(1024*1024); //1M
//        diskFileItemFactory.setRepository(file); //ä¸´æ—¶æ–‡ä»¶çš„ä¿å­˜ç›®å½•
//        return diskFileItemFactory;
//    }

}

```

# å‘é€é‚®ä»¶

```java
package com.xhh;

import com.sun.mail.util.MailSSLSocketFactory;

import javax.mail.Address;
import javax.mail.Message;
import javax.mail.Session;
import javax.mail.Transport;
import javax.mail.internet.InternetAddress;
import javax.mail.internet.MimeMessage;
import java.security.GeneralSecurityException;
import java.util.Properties;

/**
 * @author xhh
 * @date 2021/3/5 22:29
 */
public class Test {
    //ç®€å•é‚®ä»¶ï¼Œçº¯æ–‡æœ¬æ ¼å¼
    public static void main(String[] args) throws Exception {
        Properties properties = new Properties();
        // è®¾ç½®é‚®ä»¶æœåŠ¡å™¨ä¸»æœºå
        properties.setProperty("mail.host", "smtp.qq.com");
        // å‘é€é‚®ä»¶åè®®åç§°
        properties.setProperty("mail.transport.protocol", "smtp");
        // å‘é€æœåŠ¡å™¨éœ€è¦èº«ä»½éªŒè¯
        properties.setProperty("mail.smtp.auth", "true");

        //å…³äºQQé‚®ç®±ï¼Œè¿˜éœ€è¦å¼€å¯SSLåŠ å¯†
        MailSSLSocketFactory sf = new MailSSLSocketFactory();
        sf.setTrustAllHosts(true);
        properties.put("mail.smtp.ssl.enable", "true");
        properties.put("mail.smtp.ssl.socketFactory", sf);


        //è®¾ç½®ç¯å¢ƒå˜é‡
        Session session = Session.getInstance(properties);
        //å¼€å¯Debug
        session.setDebug(true);
        //é€šè¿‡Sessionå¾—åˆ°transportå¯¹è±¡
        Transport ts = session.getTransport();

        //ä½¿ç”¨é‚®ç®±çš„ç”¨æˆ·åå’Œæˆæƒç ç™»å…¥é‚®ç®±
        ts.connect("smtp.qq.com","1924292900@qq.com","xjzwzjwbihuudbfc");

        //åˆ›å»ºé‚®ä»¶å¯¹è±¡
        MimeMessage mimeMessage = new MimeMessage(session);

        //æŒ‡æ˜é‚®ä»¶çš„å‘é€äºº
        mimeMessage.setFrom(new InternetAddress("1924292900@qq.com"));
        //æ”¶ä»¶äºº
        mimeMessage.setRecipient(Message.RecipientType.TO,new InternetAddress("xhh19990210@163.com"));
        //ts.sendMessage(mimeMessage,new Address[]{new InternetAddress("xhh19990210@163.com")});
        mimeMessage.setSubject("æµ‹è¯•é‚®ä»¶");//è®¾ç½®é‚®ä»¶ä¸»é¢˜
        mimeMessage.setText("ä½ å¥½å‘€");//é‚®ä»¶å†…å®¹
        //å‘é€é‚®ä»¶
        ts.sendMessage(mimeMessage,mimeMessage.getAllRecipients());
        //å…³é—­è¿æ¥
        ts.close();
    }
}

```

